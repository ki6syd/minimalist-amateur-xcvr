Version 4
SHEET 1 3216 11436
WIRE 640 320 384 320
WIRE 384 416 384 400
WIRE 416 416 384 416
WIRE 448 416 416 416
WIRE 640 432 640 320
WIRE 640 432 512 432
WIRE 688 432 640 432
WIRE 736 432 688 432
WIRE 816 432 736 432
WIRE 448 448 320 448
WIRE 800 592 384 592
WIRE 800 640 800 592
WIRE 384 656 384 592
WIRE 416 656 384 656
WIRE 432 656 416 656
WIRE 560 656 496 656
WIRE 384 752 384 736
WIRE 416 752 384 752
WIRE 448 752 416 752
WIRE 560 768 560 656
WIRE 560 768 512 768
WIRE 592 768 560 768
WIRE 736 768 672 768
WIRE 800 768 800 720
WIRE 800 768 736 768
WIRE 832 768 800 768
WIRE 912 768 832 768
WIRE 448 784 320 784
FLAG 160 528 0
FLAG 160 448 VDD
FLAG 736 512 0
FLAG 320 528 0
FLAG 816 496 0
FLAG 416 416 INM
FLAG 688 432 OUT
FLAG 480 464 0
FLAG 480 400 VDD
FLAG 832 848 0
FLAG 320 864 0
FLAG 912 832 0
FLAG 416 752 INM2
FLAG 736 768 OUT2
FLAG 480 800 0
FLAG 480 736 VDD
FLAG 416 656 FB2
SYMBOL voltage 160 432 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 3.3
SYMBOL res 720 416 R0
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL voltage 320 432 R0
WINDOW 0 -13 -5 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 1.65
SYMBOL voltage 384 304 R0
WINDOW 0 -61 26 Bottom 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 -63 56 Bottom 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value ""
SYMATTR Value2 AC 1
SYMBOL cap 800 432 R0
SYMATTR InstName C1
SYMATTR Value 1n
SYMBOL OpAmps\\opamp2 480 368 R0
WINDOW 3 37 89 Left 2
SYMATTR InstName U1
SYMATTR Value LMV321A
SYMBOL res 816 752 R0
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL voltage 320 768 R0
WINDOW 0 -13 -5 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 1.65
SYMBOL voltage 384 640 R0
WINDOW 0 -61 26 Bottom 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 -63 56 Bottom 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value ""
SYMATTR Value2 AC 1
SYMBOL cap 896 768 R0
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL OpAmps\\opamp2 480 704 R0
WINDOW 3 7 153 Left 2
SYMATTR InstName U2
SYMATTR Value LMV321A
SYMBOL res 688 752 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 100
SYMBOL cap 496 640 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 -22 -14 VTop 2
SYMATTR InstName C3
SYMATTR Value 1n
SYMBOL res 784 624 R0
SYMATTR InstName R4
SYMATTR Value 100k
TEXT -34 776 Left 2 !.ac oct 100 100 10Meg
TEXT 2024 1032 Left 2 !.subckt LMV321A IN+ IN- VCC VEE OUT\n******************************************************\n* MODEL DEFINITIONS:\n.model BB_SW VSWITCH(Ron=50 Roff=1e12 Von=700e-3 Voff=0)\n.model ESD_SW VSWITCH(Ron=50 Roff=1e12 Von=250e-3 Voff=0)\n.model OL_SW VSWITCH(Ron=1e-3 Roff=1e9 Von=900e-3 Voff=800e-3)\n.model OR_SW VSWITCH(Ron=10e-3 Roff=1e9 Von=1e-3 Voff=0)\n.model R_NOISELESS RES(T_ABS=-273.15)\n******************************************************\n \n\nI_OS        ESDn MID 7P\nI_B         33 MID 10P\nV_GRp       58 MID 180\nV_GRn       59 MID -180\nV_ISCp      52 MID 42\nV_ISCn      53 MID -42\nV_ORn       41 VCLP -1.22\nV11         57 40 0\nV_ORp       39 VCLP 1.22\nV12         56 38 0\nV4          29 OUT 0\nVCM_MIN     79 VEE_B -100M\nVCM_MAX     80 VCC_B 100M\nI_Q         VCC VEE 80U\nV_OS        22 33 996U\nXVOS_VCM    21 22 VCC VEE VOS_SRC_0\nC30         23 24 15.92U  \nR85         24 MID R_NOISELESS 30K \nR84         24 23 R_NOISELESS 10K \nR83         23 MID R_NOISELESS 1 \nGVCCS10     26 MID 25 MID  -1\nC29         27 MID 19.89F  \nR82         25 27 R_NOISELESS 10K \nR81         25 28 R_NOISELESS 70K \nR80         28 MID R_NOISELESS 1 \nGVCCS9      28 MID 24 MID  -3.8\nGVCCS4      23 MID CL_CLAMP 29  -87\nR79         30 MID R_NOISELESS 1 \nXU1         31 MID MID 30 VCCS_LIM_ZO_0\nR78         31 MID R_NOISELESS 101 \nC22         31 26 15.92F \nR65         31 26 R_NOISELESS 10K \nR64         26 MID R_NOISELESS 1 \nR63         29 30 R_NOISELESS 400K \nXCLAWn      MID VIMON VEE_B 32 VCCS_LIM_CLAW-_0\nXe_n        ESDp 33 VNSE_0\nXi_nn       ESDn MID FEMT_0_0\nXi_np       MID 33 FEMT_0_0\nS5          VEE ESDp VEE ESDp  S_VSWITCH_1\nS4          VEE ESDn VEE ESDn  S_VSWITCH_2\nS2          ESDn VCC ESDn VCC  S_VSWITCH_3\nS3          ESDp VCC ESDp VCC  S_VSWITCH_4\nC28         34 MID 1P \nR77         35 34 R_NOISELESS 100 \nC27         36 MID 1P \nR76         37 36 R_NOISELESS 100 \nR75         MID 38 R_NOISELESS 1 \nGVCCS8      38 MID 39 MID  -1\nR74         40 MID R_NOISELESS 1 \nGVCCS7      40 MID 41 MID  -1\nC25         42 MID 25F \nR69         MID 42 R_NOISELESS 1MEG \nGVCCS6      42 MID VSENSE MID  -1U\nC20         CLAMP MID 151.6N \nR68         MID CLAMP R_NOISELESS 1MEG \nXVCCS_LIM_2 43 MID MID CLAMP VCCS_LIM_2_0\nR44         MID 43 R_NOISELESS 1MEG \nXVCCS_LIM_1 44 45 MID 43 VCCS_LIM_1_0\nRdummy      MID 29 R_NOISELESS 40K \nR61         MID 46 R_NOISELESS 273.3609 \nC16         46 47 1.1018N \nR58         47 46 R_NOISELESS 100MEG \nGVCCS2      47 MID VEE_B MID  -258.98M\nR57         MID 47 R_NOISELESS 1 \nR56         MID 48 R_NOISELESS 273.3609 \nC15         48 49 1.1018N \nR55         49 48 R_NOISELESS 100MEG \nGVCCS1      49 MID VCC_B MID  -258.98M\nR54         MID 49 R_NOISELESS 1 \nR49         MID 50 R_NOISELESS 337.4K \nC14         50 51 591.7F \nR48         51 50 R_NOISELESS 100MEG \nG_adjust    51 MID ESDp MID  -44.81M\nRsrc        MID 51 R_NOISELESS 1 \nXIQPos      VIMON MID MID VCC VCCS_LIMIT_IQ_0\nXIQNeg      MID VIMON VEE MID VCCS_LIMIT_IQ_0\nC_DIFF      ESDp ESDn 1P \nXCL_AMP     52 53 VIMON MID 54 55 CLAMP_AMP_LO_0\nSOR_SWp     CLAMP 56 CLAMP 56  S_VSWITCH_5\nSOR_SWn     57 CLAMP 57 CLAMP  S_VSWITCH_6\nXGR_AMP     58 59 60 MID 61 62 CLAMP_AMP_HI_0\nR39         58 MID R_NOISELESS 1T \nR37         59 MID R_NOISELESS 1T \nR42         VSENSE 60 R_NOISELESS 1M \nC19         60 MID 1F \nR38         61 MID R_NOISELESS 1 \nR36         MID 62 R_NOISELESS 1 \nR40         61 63 R_NOISELESS 1M \nR41         62 64 R_NOISELESS 1M \nC17         63 MID 1F \nC18         MID 64 1F \nXGR_SRC     63 64 CLAMP MID VCCS_LIM_GR_0\nR21         54 MID R_NOISELESS 1 \nR20         MID 55 R_NOISELESS 1 \nR29         54 65 R_NOISELESS 1M \nR30         55 66 R_NOISELESS 1M \nC9          65 MID 1F \nC8          MID 66 1F \nXCL_SRC     65 66 CL_CLAMP MID VCCS_LIM_4_0\nR22         52 MID R_NOISELESS 1T \nR19         MID 53 R_NOISELESS 1T \nXCLAWp      VIMON MID 67 VCC_B VCCS_LIM_CLAW+_0\nR12         67 VCC_B R_NOISELESS 1K \nR16         67 68 R_NOISELESS 1M \nR13         VEE_B 32 R_NOISELESS 1K \nR17         69 32 R_NOISELESS 1M \nC6          69 MID 1F \nC5          MID 68 1F \nG2          VCC_CLP MID 68 MID  -1M\nR15         VCC_CLP MID R_NOISELESS 1K \nG3          VEE_CLP MID 69 MID  -1M\nR14         MID VEE_CLP R_NOISELESS 1K \nXCLAW_AMP   VCC_CLP VEE_CLP VOUT_S MID 70 71 CLAMP_AMP_LO_0\nR26         VCC_CLP MID R_NOISELESS 1T \nR23         VEE_CLP MID R_NOISELESS 1T \nR25         70 MID R_NOISELESS 1 \nR24         MID 71 R_NOISELESS 1 \nR27         70 72 R_NOISELESS 1M \nR28         71 73 R_NOISELESS 1M \nC11         72 MID 1F \nC10         MID 73 1F \nXCLAW_SRC   72 73 CLAW_CLAMP MID VCCS_LIM_3_0\nH2          37 MID V11 -1\nH3          35 MID V12 1\nC12         SW_OL MID 100P \nR32         74 SW_OL R_NOISELESS 100 \nR31         74 MID R_NOISELESS 1 \nXOL_SENSE   MID 74 36 34 OL_SENSE_0\nS1          23 24 SW_OL MID  S_VSWITCH_7\nH1          75 MID V4 1K\nS7          VEE OUT VEE OUT  S_VSWITCH_8\nS6          OUT VCC OUT VCC  S_VSWITCH_9\nR11         MID 76 R_NOISELESS 1T \nR18         76 VOUT_S R_NOISELESS 100 \nC7          VOUT_S MID 1P \nE5          76 MID OUT MID  1\nC13         VIMON MID 1N \nR33         75 VIMON R_NOISELESS 100 \nR10         MID 75 R_NOISELESS 1T \nR47         77 VCLP R_NOISELESS 100 \nC24         VCLP MID 100P \nE4          77 MID CL_CLAMP MID  1\nR46         MID CL_CLAMP R_NOISELESS 1K \nG9          CL_CLAMP MID CLAW_CLAMP MID  -1M\nR45         MID CLAW_CLAMP R_NOISELESS 1K \nG8          CLAW_CLAMP MID 42 MID  -1M\nR43         MID VSENSE R_NOISELESS 1K \nG15         VSENSE MID CLAMP MID  -1M\nC4          44 MID 1F \nR9          44 78 R_NOISELESS 1M \nR7          MID 79 R_NOISELESS 1T \nR6          80 MID R_NOISELESS 1T \nR8          MID 78 R_NOISELESS 1 \nXVCM_CLAMP  81 MID 78 MID 80 79 VCCS_EXT_LIM_0\nE1          MID 0 82 0  1\nR89         VEE_B 0 R_NOISELESS 1 \nR5          83 VEE_B R_NOISELESS 1M \nC3          83 0 1F \nR60         82 83 R_NOISELESS 1MEG \nC1          82 0 100e-9 \nR3          82 0 R_NOISELESS 1T \nR59         84 82 R_NOISELESS 1MEG \nC2          84 0 1F \nR4          VCC_B 84 R_NOISELESS 1M \nR88         VCC_B 0 R_NOISELESS 1 \nG17         VEE_B 0 VEE 0  -1\nG16         VCC_B 0 VCC 0  -1\nR_PSR       85 81 R_NOISELESS 1K \nG_PSR       81 85 48 46  -1M\nR2          45 ESDn R_NOISELESS 1M \nR1          85 86 R_NOISELESS 1M \nR_CMR       21 86 R_NOISELESS 1K \nG_CMR       86 21 50 MID  -1M\nC_CMn       ESDn MID 5P \nC_CMp       MID ESDp 5P \nR53         ESDn MID R_NOISELESS 1T \nR52         MID ESDp R_NOISELESS 1T \nR35         IN- ESDn R_NOISELESS 10M \nR34         IN+ ESDp R_NOISELESS 10M \n \n.MODEL S_VSWITCH_1 VSWITCH (RON=50 ROFF=1T VON=500M VOFF=100M)\n.MODEL S_VSWITCH_2 VSWITCH (RON=50 ROFF=1T VON=500M VOFF=100M)\n.MODEL S_VSWITCH_3 VSWITCH (RON=50 ROFF=1T VON=500M VOFF=100M)\n.MODEL S_VSWITCH_4 VSWITCH (RON=50 ROFF=1T VON=500M VOFF=100M)\n.MODEL S_VSWITCH_5 VSWITCH (RON=10M ROFF=1T VON=10M VOFF=0)\n.MODEL S_VSWITCH_6 VSWITCH (RON=10M ROFF=1T VON=10M VOFF=0)\n.MODEL S_VSWITCH_7 VSWITCH (RON=1M ROFF=1T VON=500M VOFF=100M)\n.MODEL S_VSWITCH_8 VSWITCH (RON=50 ROFF=1T VON=500M VOFF=100M)\n.MODEL S_VSWITCH_9 VSWITCH (RON=50 ROFF=1T VON=500M VOFF=100M)\n \n.ENDS LMV321A\n*\n.SUBCKT VOS_SRC_0  V+ V- REF+ REF-\nE1 V+ 1 TABLE {(V(REF+, V-))} =\n+(0, 0.8E-3)\n+(1, 0.8E-3)\n+(1.3, 0)\n+(5.5, 0)\nE2 1 V- TABLE {(V(V-, REF-))}=\n+(-0.7, -2E-4)\n+(-0.5, -2E-4)\n+(-0.4, 0)\n+(5.5, 0)\n.ENDS VOS_SRC_0 \n*\n \n\n.SUBCKT VCCS_LIM_ZO_0  VC+ VC- IOUT+ IOUT-\n.PARAM GAIN = 100\n.PARAM IPOS = 35E3\n.PARAM INEG = -35E3\nG1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),INEG,IPOS)}\n.ENDS\n*\n \n\n.SUBCKT VCCS_LIM_CLAW-_0  VC+ VC- IOUT+ IOUT-\nG1 IOUT+ IOUT- TABLE {ABS(V(VC+,VC-))} =\n+(00.0000, 0.00001)\n+(14.0000, 0.000379)\n+(28.0000, 0.000877)\n+(37.3333, 0.001382)\n+(37.8000, 0.00142)\n+(38.7333, 0.001493)\n+(39.6667, 0.001583)\n+(40.6000, 0.001703)\n+(41.5333, 0.00191)\n+(42.0000, 0.00204)\n.ENDS VCCS_LIM_CLAW-_0 \n*\n \n\n.SUBCKT VNSE_0  1 2\n.PARAM FLW=10\n.PARAM NLF=115\n.PARAM NVR=27\n.PARAM GLF={PWR(FLW,0.25)*NLF/1164}\n.PARAM RNV={1.184*PWR(NVR,2)}\n.MODEL DVN D KF={PWR(FLW,0.5)/1E11} IS=1.0E-16\nI1 0 7 10E-3\nI2 0 8 10E-3\nD1 7 0 DVN\nD2 8 0 DVN\nE1 3 6 7 8 {GLF}\nR1 3 0 1E9\nR2 3 0 1E9\nR3 3 6 1E9\nE2 6 4 5 0 10\nR4 5 0 {RNV}\nR5 5 0 {RNV}\nR6 3 4 1E9\nR7 4 0 1E9\nE3 1 2 3 4 1\n.ENDS\n*\n \n\n.SUBCKT FEMT_0_0   1 2\n.PARAM FLWF=0.001\n.PARAM NLFF=25\n.PARAM NVRF=23\n.PARAM GLFF={PWR(FLWF,0.25)*NLFF/1164}\n.PARAM RNVF={1.184*PWR(NVRF,2)}\n.MODEL DVNF D KF={PWR(FLWF,0.5)/1E11} IS=1.0E-16\nI1 0 7 10E-3\nI2 0 8 10E-3\nD1 7 0 DVNF\nD2 8 0 DVNF\nE1 3 6 7 8 {GLFF}\nR1 3 0 1E9\nR2 3 0 1E9\nR3 3 6 1E9\nE2 6 4 5 0 10\nR4 5 0 {RNVF}\nR5 5 0 {RNVF}\nR6 3 4 1E9\nR7 4 0 1E9\nG1 1 2 3 4 1E-6\n.ENDS\n*\n \n\n.SUBCKT VCCS_LIM_2_0  VC+ VC- IOUT+ IOUT-\n.PARAM GAIN = 11.15E-3\n.PARAM IPOS = 0.300\n.PARAM INEG = -0.300\nG1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),INEG,IPOS)}\n.ENDS\n*\n \n\n.SUBCKT VCCS_LIM_1_0  VC+ VC- IOUT+ IOUT-\n.PARAM GAIN = 1E-4\n.PARAM IPOS = .5\n.PARAM INEG = -.5\nG1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),INEG,IPOS)}\n.ENDS\n*\n \n\n.SUBCKT VCCS_LIMIT_IQ_0  VC+ VC- IOUT+ IOUT-\n.PARAM GAIN = 1E-3\nG1 IOUT- IOUT+ VALUE={IF( (V(VC+,VC-)<=0),0,GAIN*V(VC+,VC-) )}\n.ENDS\n*\n \n\n.SUBCKT CLAMP_AMP_LO_0  VC+ VC- VIN COM VO+ VO-\n.PARAM G=1\nGVO+ COM VO+ VALUE = {IF(V(VIN,COM)>V(VC+,COM),((V(VIN,COM)-V(VC+,COM))*G),0)}\nGVO- COM VO- VALUE = {IF(V(VIN,COM)<V(VC-,COM),((V(VC-,COM)-V(VIN,COM))*G),0)}\n.ENDS\n*\n \n\n.SUBCKT CLAMP_AMP_HI_0  VC+ VC- VIN COM VO+ VO-\n.PARAM G=10\nGVO+ COM VO+ VALUE = {IF(V(VIN,COM)>V(VC+,COM),((V(VIN,COM)-V(VC+,COM))*G),0)}\nGVO- COM VO- VALUE = {IF(V(VIN,COM)<V(VC-,COM),((V(VC-,COM)-V(VIN,COM))*G),0)}\n.ENDS\n*\n \n\n.SUBCKT VCCS_LIM_GR_0  VC+ VC- IOUT+ IOUT-\n.PARAM GAIN = 1\n.PARAM IPOS = 0.7\n.PARAM INEG = -0.7\nG1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),INEG,IPOS)}\n.ENDS\n*\n \n\n.SUBCKT VCCS_LIM_4_0  VC+ VC- IOUT+ IOUT-\n.PARAM GAIN = 1\n.PARAM IPOS = 0.8\n.PARAM INEG = -0.8\nG1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),INEG,IPOS)}\n.ENDS\n*\n \n\n.SUBCKT VCCS_LIM_CLAW+_0  VC+ VC- IOUT+ IOUT-\nG1 IOUT+ IOUT- TABLE {ABS(V(VC+,VC-))} =\n+(00.00, 0.000010)\n+(13.67, 0.0003467)\n+(27.33, 0.0007994)\n+(36.44, 0.001309)\n+(36.90, 0.001351)\n+(37.81, 0.001455)\n+(38.72, 0.001600)\n+(39.63, 0.001812)\n+(40.54, 0.002117)\n+(41.00, 0.002292)\n.ENDS VCCS_LIM_CLAW+_0 \n*\n \n\n.SUBCKT VCCS_LIM_3_0  VC+ VC- IOUT+ IOUT-\n.PARAM GAIN = 1\n.PARAM IPOS = 0.400\n.PARAM INEG = -0.400\nG1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),INEG,IPOS)}\n.ENDS\n*\n \n\n.SUBCKT OL_SENSE_0  COM SW+ OLN  OLP\nGSW+ COM SW+ VALUE = {IF((V(OLN,COM)>10E-3 | V(OLP,COM)>10E-3),1,0)}\n.ENDS\n*\n \n\n.SUBCKT VCCS_EXT_LIM_0  VIN+ VIN- IOUT- IOUT+ VP+ VP-\n.PARAM GAIN = 1\nG1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VIN+,VIN-),V(VP-,VIN-), V(VP+,VIN-))}\n.ENDS\n*
